<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rota — İstanbul → Güney Amerika (Afrika kıyı duraklı, kıvrımlı)</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2a6aff">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  html,body,#map{height:100%;margin:0;font-family:system-ui,Arial}
  /* marker dot */
  .dot{background:#fff;border:3px solid #2a6aff;border-radius:50%;width:14px;height:14px;box-shadow:0 1px 4px rgba(0,0,0,0.25)}
  /* tooltip style for permanent labels (Leaflet tooltip className) */
  .wp-label{
    background:rgba(0,0,0,.65);
    color:#fff;
    padding:4px 8px;
    border-radius:6px;
    font-size:12px;
    box-shadow:0 2px 6px rgba(0,0,0,0.25);
  }
  .legend{position:absolute;left:12px;bottom:12px;background:#0b1020;color:#fff;padding:10px 12px;border-radius:10px;opacity:.95;z-index:999;max-width:360px;font-size:13px}
  /* subtle vignette */
  #map::after { content:""; position: absolute; inset:0; pointer-events:none; box-shadow: inset 0 0 160px rgba(0,0,0,0.12);}
</style>
</head>
<body>
<div id="map"></div>
<div class="legend">
  İstanbul → Çanakkale → Tunus → Cezayir (Algiers) → Oran → Gibraltar → Tangier → Casablanca → Las Palmas → Praia → Dakar → Abidjan → Recife → Rio → Buenos Aires
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

<script>
// ===== WAYPOINTS (Tunus + Cezayir + diğer Afrika durakları) =====
const waypoints = [
  {name:"İstanbul", lat:41.01, lon:28.97},
  {name:"Çanakkale (Dardanel)", lat:40.15, lon:26.41},
  {name:"Tunus (La Goulette)", lat:36.80, lon:10.18},
  {name:"Algiers (Cezayir)", lat:36.75, lon:3.06},
  {name:"Oran (Cezayir)", lat:35.69, lon:-0.64},
  {name:"Gibraltar", lat:36.14, lon:-5.35},
  {name:"Tangier (Fas)", lat:35.79, lon:-5.81},
  {name:"Casablanca (Fas)", lat:33.57, lon:-7.59},
  {name:"Las Palmas (Kanarya)", lat:28.12, lon:-15.43},
  {name:"Praia (Cape Verde)", lat:14.92, lon:-23.51},
  {name:"Dakar (Senegal)", lat:14.69, lon:-17.44},
  {name:"Abidjan (Fildişi Sahili)", lat:5.36, lon:-4.01},
  {name:"Recife (Brezilya)", lat:-8.05, lon:-34.88},
  {name:"Rio de Janeiro", lat:-22.90, lon:-43.20},
  {name:"Buenos Aires", lat:-34.60, lon:-58.38}
];

// ===== MAP SETUP =====
const map = L.map('map',{zoomControl:true}).setView([18,-10],3);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap katkıcıları'
}).addTo(map);

// ===== MARKERS (temiz, tooltip olarak gösterim) =====
waypoints.forEach(p=>{
  const marker = L.marker([p.lat,p.lon],{
    icon: L.divIcon({className:'', html:`<div class="dot"></div>`, iconSize:[14,14], iconAnchor:[7,7]})
  }).addTo(map);
  marker.bindTooltip(p.name, {permanent:true, direction:'top', offset:[0,-12], className:'wp-label'});
});

// ===== BUILD SMOOTH, REALISTIC ROUTE =====
// We'll build segment-by-segment great-circle paths with higher resolution
let fullCoords = [];
for(let i=0;i<waypoints.length-1;i++){
  const a = waypoints[i];
  const b = waypoints[i+1];
  const from = [a.lon, a.lat];
  const to   = [b.lon, b.lat];

  // distance (km) and npoints scaled for smoother long segments
  const distKm = turf.distance(turf.point(from), turf.point(to));
  // use a larger multiplier for smoother curvature; clamp to avoid huge arrays
  let npoints = Math.min(Math.max(Math.round(distKm * 4), 80), 800);

  const gc = turf.greatCircle(from, to, {npoints: npoints});
  gc.geometry.coordinates.forEach((ll, idx)=>{
    const latlng = [ll[1], ll[0]];
    // avoid duplicating endpoints
    if(fullCoords.length && idx === 0){
      const last = fullCoords[fullCoords.length-1];
      if(Math.abs(last[0]-latlng[0])<1e-6 && Math.abs(last[1]-latlng[1])<1e-6) return;
    }
    fullCoords.push(latlng);
  });
}

// ===== DRAW GLOW + MAIN ROUTE =====
L.polyline(fullCoords, {color:'#6aa6ff', weight:20, opacity:0.16, interactive:false}).addTo(map);
const route = L.polyline(fullCoords, {color:'#2a6aff', weight:5, opacity:0.96}).addTo(map);

// optional: emphasize long ocean crossing with a subtle marker
const oceanIdx = Math.floor(fullCoords.length * 0.48);
if(fullCoords[oceanIdx]){
  L.circleMarker(fullCoords[oceanIdx], {radius:5, fill:true, fillColor:'#fff', color:'#2a6aff', weight:2, opacity:0.95})
    .addTo(map).bindTooltip('Büyük Atlantik Geçişi',{direction:'right', className:'wp-label'});
}

// fit to route bounds with padding
map.fitBounds(route.getBounds(), {padding:[80,80]});

// ===== PWA: register service worker (keeps previous behavior) =====
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./service-worker.js').then(reg=>{
    console.log('ServiceWorker registered:', reg.scope);
  }).catch(err=>{
    console.warn('SW register failed:', err);
  });
}
</script>
</body>
</html>
