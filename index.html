<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rota — İstanbul → Güney Amerika (Afrika duraklı)</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2a6aff">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  html,body,#map{height:100%;margin:0;font-family:system-ui,Arial}
  .dot{background:#fff;border:3px solid #2a6aff;border-radius:50%;width:14px;height:14px}
  .label{background:rgba(0,0,0,.6);color:#fff;padding:2px 6px;border-radius:6px;font:12px/1.2 system-ui}
  .legend{position:absolute;left:12px;bottom:12px;background:#111;color:#fff;padding:10px 12px;border-radius:10px;opacity:.95;z-index:999}
  #map::after { content:""; position: absolute; inset:0; pointer-events:none; box-shadow: inset 0 0 120px rgba(0,0,0,0.12);}
</style>
</head>
<body>
<div id="map"></div>
<div class="legend">İstanbul → Çanakkale → Gibraltar → Tangier → Casablanca → Las Palmas → Praia → Dakar → Abidjan → Recife → Rio → Buenos Aires</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

<script>
// ====== WAYPOINTS (Afrika duraklı) ======
// Lat / Lon formatı: {name, lat, lon}
const waypoints = [
  {name:"İstanbul", lat:41.01, lon:28.97},
  {name:"Çanakkale (Dardanel)", lat:40.15, lon:26.41},
  {name:"Gibraltar", lat:36.14, lon:-5.35},
  {name:"Tangier (Fas)", lat:35.79, lon:-5.81},
  {name:"Casablanca (Fas)", lat:33.57, lon:-7.59},
  {name:"Las Palmas (Canary)", lat:28.12, lon:-15.43},
  {name:"Praia (Cape Verde)", lat:14.92, lon:-23.51},
  {name:"Dakar (Senegal)", lat:14.69, lon:-17.44},
  {name:"Abidjan (Fildişi Sahili)", lat:5.36, lon:-4.01},
  {name:"Recife Açıkları", lat:-8.05, lon:-34.90},
  {name:"Rio de Janeiro", lat:-22.90, lon:-43.20},
  {name:"Buenos Aires", lat:-34.60, lon:-58.38}
];

// ====== MAP SETUP ======
const map = L.map('map',{zoomControl:true}).setView([10,-25],3);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap'
}).addTo(map);

// Add markers + labels
waypoints.forEach(p=>{
  L.marker([p.lat,p.lon],{icon: L.divIcon({className:'dot',iconSize:[14,14]})})
    .addTo(map).bindTooltip(p.name,{permanent:true,direction:'top',offset:[0,-10],className:'label'});
});

// ====== BUILD ROUTE: segment-by-segment great-circle (turf) ======
let fullCoords = [];
for(let i=0;i<waypoints.length-1;i++){
  const a = waypoints[i];
  const b = waypoints[i+1];
  const from = [a.lon, a.lat];
  const to   = [b.lon, b.lat];

  // mesafeye göre nokta sayısı (daha uzun segment, daha çok nokta)
  const distKm = turf.distance(turf.point(from), turf.point(to));
  let npoints = Math.min(Math.max(Math.round(distKm * 2), 40), 400);

  const gc = turf.greatCircle(from, to, {npoints: npoints});
  gc.geometry.coordinates.forEach((ll, idx)=>{
    const latlng = [ll[1], ll[0]];
    // uç noktayı iki kez eklememek için kontrol
    if(fullCoords.length && idx === 0){
      const last = fullCoords[fullCoords.length-1];
      if(Math.abs(last[0]-latlng[0])<1e-6 && Math.abs(last[1]-latlng[1])<1e-6) return;
    }
    fullCoords.push(latlng);
  });
}

// draw glow + main route
L.polyline(fullCoords,{color:'#6aa6ff',weight:18,opacity:0.16}).addTo(map);
const route = L.polyline(fullCoords,{color:'#2a6aff',weight:5,opacity:0.95}).addTo(map);

// optional: mark the big ocean crossing point visually
const atlanticIndex = Math.floor(fullCoords.length*0.45);
if(fullCoords[atlanticIndex]) {
  L.circleMarker(fullCoords[atlanticIndex],{radius:5,fill:true,fillColor:'#fff',color:'#2a6aff',weight:2})
    .addTo(map).bindTooltip('Büyük Atlantik Geçişi',{direction:'right',className:'label'});
}

map.fitBounds(route.getBounds(),{padding:[60,60]});

// register service worker (relative path)
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('./service-worker.js').then(reg=>{
    console.log('SW registered:', reg.scope);
  }).catch(err=>{
    console.warn('SW register failed:', err);
  });
}
</script>
</body>
</html>
