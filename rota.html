<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gerçekçi Rota — İstanbul → Güney Amerika</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2a6aff">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  html,body,#map{height:100%;margin:0;font-family:system-ui,Arial}
  .dot{background:#fff;border:3px solid #2a6aff;border-radius:50%;width:14px;height:14px}
  .label{background:rgba(0,0,0,.6);color:#fff;padding:2px 6px;border-radius:6px;font:12px/1.2 system-ui}
  .legend{position:absolute;left:12px;bottom:12px;background:#111;color:#fff;padding:10px 12px;border-radius:10px;opacity:.95;z-index:999}
  /* küçük estetik: hafif vignette */
  #map::after { content:""; position: absolute; inset:0; pointer-events:none;
    box-shadow: inset 0 0 120px rgba(0,0,0,0.12);}
</style>
</head>
<body>
<div id="map"></div>
<div class="legend">İstanbul → Çanakkale → Gibraltar → Kanarya → Recife → Rio → Buenos Aires</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@turf/turf/turf.min.js"></script>

<script>
// ===== WAYPOINT'LER (okunması kolay olsun diye lat/lon şeklinde) =====
const waypoints = [
  {name:"İstanbul", lat:41.01, lon:28.97},
  {name:"Çanakkale (Dardanel)", lat:40.15, lon:26.41},
  {name:"Cebelitarık", lat:36.14, lon:-5.35},
  {name:"Kanarya Yaklaşımı", lat:28.10, lon:-15.40},
  {name:"Recife Açıkları", lat:-8.05, lon:-34.90},
  {name:"Rio de Janeiro", lat:-22.90, lon:-43.20},
  {name:"Buenos Aires", lat:-34.60, lon:-58.38}
];

// ===== HARİTA (Leaflet) =====
const map = L.map('map',{zoomControl:true}).setView([10,-30],3);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap'
}).addTo(map);

// markers + tooltip
waypoints.forEach(p=>{
  L.marker([p.lat,p.lon],{
    icon: L.divIcon({className:'dot',iconSize:[14,14]})
  }).addTo(map).bindTooltip(p.name,{permanent:true,direction:'top',offset:[0,-10],className:'label'});
});

// ===== Gerçekçi rota: waypoint'ler arası great-circle segmentleri =====
let fullCoords = [];
for(let i=0;i<waypoints.length-1;i++){
  const a = waypoints[i];
  const b = waypoints[i+1];
  const from = [a.lon, a.lat]; // turf: [lon,lat]
  const to   = [b.lon, b.lat];

  // segment uzunluğuna göre nokta sayısı belirle
  const distKm = turf.distance(turf.point(from), turf.point(to)); // km
  let npoints = Math.min(Math.max(Math.round(distKm * 2), 50), 350);

  // great-circle üret
  const gc = turf.greatCircle(from, to, {npoints: npoints});
  gc.geometry.coordinates.forEach((ll, idx)=>{
    const latlng = [ll[1], ll[0]];
    // tekrar eden uç noktayı ekleme
    if(fullCoords.length && idx === 0) {
      const last = fullCoords[fullCoords.length-1];
      if(Math.abs(last[0]-latlng[0])<1e-6 && Math.abs(last[1]-latlng[1])<1e-6) return;
    }
    fullCoords.push(latlng);
  });
}

// glow then main line
L.polyline(fullCoords,{color:'#6aa6ff',weight:18,opacity:0.16}).addTo(map);
const route = L.polyline(fullCoords,{color:'#2a6aff',weight:5,opacity:0.95}).addTo(map);

// örnek: uzun okyanus geçişine küçük işaret
const mid = fullCoords[Math.floor(fullCoords.length*0.35)];
if(mid) L.circleMarker(mid,{radius:4,fill:true,fillColor:'#fff',color:'#2a6aff',weight:2}).addTo(map).bindTooltip('Atlantik Geçişi',{direction:'right',className:'label'});

// görünümü sığdır
map.fitBounds(route.getBounds(),{padding:[60,60]});

// ===== Service Worker (PWA) kaydı =====
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(err=>console.warn('SW kayıt hatası:',err));
}
</script>
</body>
</html>
